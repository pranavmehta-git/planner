<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .greeting {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .summary {
            background: #f0f7ff;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            font-size: 15px;
            color: #1e40af;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .week-nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .week-nav button {
            padding: 8px 16px;
            border: none;
            background: #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .week-nav button:hover {
            background: #d1d5db;
        }

        .week-label {
            font-weight: 600;
            min-width: 120px;
            text-align: center;
        }

        .add-btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-left: auto;
        }

        .add-btn:hover {
            background: #2563eb;
        }

        .tasks-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .day-section {
            border-bottom: 1px solid #e5e7eb;
        }

        .day-section:last-child {
            border-bottom: none;
        }

        .day-header {
            background: #f9fafb;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 14px;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
        }

        .day-header.today {
            background: #dbeafe;
            color: #1e40af;
        }

        .task-list {
            padding: 0;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            border-bottom: 1px solid #f3f4f6;
            gap: 12px;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item.completed {
            background: #f9fafb;
        }

        .task-item.completed .task-name,
        .task-item.completed .task-subject {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .task-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #3b82f6;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            font-size: 15px;
        }

        .task-subject {
            font-size: 13px;
            color: #6b7280;
            margin-top: 2px;
        }

        .task-type {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .task-type.assignment { background: #dbeafe; color: #1e40af; }
        .task-type.exam { background: #fee2e2; color: #991b1b; }
        .task-type.project { background: #d1fae5; color: #065f46; }
        .task-type.presentation { background: #fef3c7; color: #92400e; }
        .task-type.deliverable { background: #e9d5ff; color: #6b21a8; }

        .task-time {
            font-size: 13px;
            color: #6b7280;
            min-width: 80px;
            text-align: right;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-actions button {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .edit-btn:hover {
            background: #e5e7eb;
        }

        .delete-btn {
            background: #fee2e2;
            color: #991b1b;
        }

        .delete-btn:hover {
            background: #fecaca;
        }

        .no-tasks {
            padding: 40px;
            text-align: center;
            color: #9ca3af;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
        }

        .modal h2 {
            margin-bottom: 20px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .modal-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .cancel-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .save-btn {
            background: #3b82f6;
            color: white;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            background: #e5e7eb;
            padding: 4px;
            border-radius: 8px;
        }

        .view-toggle button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .view-toggle button.active {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .all-tasks .task-date {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }

        /* Birthday styles */
        .birthday-reminder {
            background: #fef3c7;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
            font-size: 14px;
            color: #92400e;
            margin-top: 12px;
        }

        .birthday-reminder strong {
            color: #b45309;
        }

        .birthdays-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-top: 20px;
            overflow: hidden;
        }

        .birthdays-header {
            background: #fef3c7;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #fde68a;
        }

        .birthdays-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #92400e;
        }

        .birthdays-header-actions {
            display: flex;
            gap: 8px;
        }

        .add-birthday-btn {
            padding: 8px 16px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .add-birthday-btn:hover {
            background: #d97706;
        }

        .export-btn {
            padding: 8px 16px;
            background: #e5e7eb;
            color: #374151;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .export-btn:hover {
            background: #d1d5db;
        }

        .birthday-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .birthday-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid #f3f4f6;
            gap: 12px;
        }

        .birthday-item:last-child {
            border-bottom: none;
        }

        .birthday-item.upcoming {
            background: #fffbeb;
        }

        .birthday-icon {
            width: 40px;
            height: 40px;
            background: #fef3c7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .birthday-info {
            flex: 1;
        }

        .birthday-name {
            font-weight: 500;
            font-size: 15px;
        }

        .birthday-date {
            font-size: 13px;
            color: #6b7280;
            margin-top: 2px;
        }

        .birthday-countdown {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
            background: #fef3c7;
            color: #92400e;
        }

        .birthday-countdown.today {
            background: #fee2e2;
            color: #991b1b;
        }

        .birthday-countdown.soon {
            background: #fef3c7;
            color: #92400e;
        }

        .birthday-actions {
            display: flex;
            gap: 8px;
        }

        .birthday-actions button {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .no-birthdays {
            padding: 40px;
            text-align: center;
            color: #9ca3af;
        }

        .toggle-birthdays-btn {
            padding: 8px 16px;
            background: #fef3c7;
            color: #92400e;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .toggle-birthdays-btn:hover {
            background: #fde68a;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="greeting" id="greeting"></div>
        <div class="summary" id="summary"></div>
        <div class="birthday-reminder" id="birthdayReminder" style="display: none;"></div>
    </div>

    <div class="controls">
        <div class="view-toggle">
            <button class="active" data-view="week">Week View</button>
            <button data-view="all">All Tasks</button>
        </div>
        <div class="week-nav" id="weekNav">
            <button id="prevWeek">&larr; Prev</button>
            <span class="week-label" id="weekLabel">Week 1</span>
            <button id="nextWeek">Next &rarr;</button>
        </div>
        <button class="add-btn" id="addTaskBtn">+ Add Task</button>
        <button class="toggle-birthdays-btn" id="toggleBirthdaysBtn">Birthdays</button>
    </div>

    <div class="tasks-container" id="tasksContainer"></div>

    <div class="birthdays-section" id="birthdaysSection" style="display: none;">
        <div class="birthdays-header">
            <h3>Birthday Reminders</h3>
            <div class="birthdays-header-actions">
                <button class="export-btn" id="exportBirthdaysBtn">Export CSV</button>
                <button class="add-birthday-btn" id="addBirthdayBtn">+ Add Birthday</button>
            </div>
        </div>
        <div class="birthday-list" id="birthdayList"></div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2 id="modalTitle">Add Task</h2>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label for="taskName">Task Name</label>
                    <input type="text" id="taskName" required>
                </div>
                <div class="form-group">
                    <label for="taskSubject">Subject/Course</label>
                    <input type="text" id="taskSubject" required>
                </div>
                <div class="form-group">
                    <label for="taskType">Type</label>
                    <select id="taskType">
                        <option value="Assignment">Assignment</option>
                        <option value="Exam">Exam</option>
                        <option value="Project">Project</option>
                        <option value="Presentation">Presentation</option>
                        <option value="Deliverable">Deliverable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskDate">Due Date</label>
                    <input type="date" id="taskDate" required>
                </div>
                <div class="form-group">
                    <label for="taskTime">Due Time</label>
                    <input type="text" id="taskTime" placeholder="e.g., 11:59 PM or TBD">
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" id="cancelBtn">Cancel</button>
                    <button type="submit" class="save-btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="birthdayModalOverlay">
        <div class="modal">
            <h2 id="birthdayModalTitle">Add Birthday</h2>
            <form id="birthdayForm">
                <input type="hidden" id="birthdayId">
                <div class="form-group">
                    <label for="birthdayName">Name</label>
                    <input type="text" id="birthdayName" required>
                </div>
                <div class="form-group">
                    <label for="birthdayMonth">Month</label>
                    <select id="birthdayMonth" required>
                        <option value="">Select month</option>
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="birthdayDay">Day</label>
                    <input type="number" id="birthdayDay" min="1" max="31" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" id="cancelBirthdayBtn">Cancel</button>
                    <button type="submit" class="save-btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initial seed data from assignments.csv
        const seedData = [
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 1", type: "Assignment", date: "2026-01-26", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 2", type: "Assignment", date: "2026-02-02", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Problem Set 1", type: "Assignment", date: "2026-02-04", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 3", type: "Assignment", date: "2026-02-09", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 4", type: "Assignment", date: "2026-02-16", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 5", type: "Assignment", date: "2026-02-22", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 6", type: "Assignment", date: "2026-03-02", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Problem Set 2", type: "Assignment", date: "2026-03-04", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 7", type: "Assignment", date: "2026-03-09", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 8", type: "Assignment", date: "2026-03-23", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Paper Topics", type: "Deliverable", date: "2026-04-01", time: "TBD" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 9", type: "Assignment", date: "2026-04-06", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 10", type: "Assignment", date: "2026-04-13", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 11", type: "Assignment", date: "2026-04-20", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Problem Set 3", type: "Assignment", date: "2026-04-22", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Final Presentation", type: "Presentation", date: "2026-04-29", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Final Paper", type: "Project", date: "2026-05-08", time: "TBD" },
            { subject: "International Trade", task: "Problem Set 1 (Chapter 3)", type: "Assignment", date: "2026-02-05", time: "TBD" },
            { subject: "International Trade", task: "Problem Set 2 (Chapter 5)", type: "Assignment", date: "2026-02-19", time: "TBD" },
            { subject: "International Trade", task: "Midterm Exam", type: "Exam", date: "2026-03-05", time: "TBD" },
            { subject: "International Trade", task: "Problem Set 3 (Chapter 9)", type: "Assignment", date: "2026-04-02", time: "TBD" },
            { subject: "International Trade", task: "Short Paper", type: "Assignment", date: "2026-04-16", time: "TBD" },
            { subject: "International Trade", task: "Final Exam", type: "Exam", date: "2026-05-08", time: "TBD" },
            { subject: "Applying Machine Learning", task: "PS 1 - Clustering", type: "Assignment", date: "2026-01-27", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 0 - Programming", type: "Assignment", date: "2026-02-03", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 2 - Visualization", type: "Assignment", date: "2026-02-03", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 3 - Trees", type: "Assignment", date: "2026-02-10", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 4 - Measurement and Fit", type: "Assignment", date: "2026-02-17", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 5 - Generalizing Fit", type: "Assignment", date: "2026-02-24", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 6 - Regularization and Loss", type: "Assignment", date: "2026-03-03", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 7 - Causality and Optimal Pricing", type: "Assignment", date: "2026-03-10", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 8 - Synthetic Data", type: "Assignment", date: "2026-03-24", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 9 - Optimal Pricing Competition", type: "Assignment", date: "2026-03-31", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 10 - Fairness", type: "Assignment", date: "2026-04-14", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 11 - AI", type: "Assignment", date: "2026-04-21", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "Project Presentation", type: "Presentation", date: "2026-04-29", time: "3:10 PM" },
            { subject: "Applying Machine Learning", task: "Final Project", type: "Project", date: "2026-05-09", time: "TBD" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 1 - Glo-Stick I", type: "Assignment", date: "2026-02-04", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 2 - Glo-Stick II", type: "Assignment", date: "2026-02-11", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 3 - Revenue Recognition", type: "Assignment", date: "2026-02-18", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 4 - Doubtful Accounts & Deferred Taxes", type: "Assignment", date: "2026-02-25", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Mid-Term Exam", type: "Exam", date: "2026-03-04", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Final Exam", type: "Exam", date: "2026-05-15", time: "TBD" },
            { subject: "Using Big Data to Develop Public Policy", task: "Final Paper Proposal Outline", type: "Deliverable", date: "2026-03-11", time: "TBD" },
            { subject: "Using Big Data to Develop Public Policy", task: "Midterm (take-home)", type: "Exam", date: "2026-03-10", time: "TBD" },
            { subject: "Using Big Data to Develop Public Policy", task: "Final Paper Presentation", type: "Presentation", date: "2026-04-28", time: "7:10 PM" },
            { subject: "Using Big Data to Develop Public Policy", task: "Final Paper", type: "Project", date: "2026-05-13", time: "TBD" }
        ];

        // Birthday seed data from birthdays.csv
        const birthdaySeedData = [
            { name: "Mummy", month: "August", day: 31 },
            { name: "Papa", month: "July", day: 20 },
            { name: "Dadima", month: "September", day: 17 },
            { name: "Pooja", month: "August", day: 19 },
            { name: "Himag", month: "January", day: 23 },
            { name: "Nadine", month: "October", day: 27 },
            { name: "Lola", month: "March", day: 10 },
            { name: "Madhav", month: "May", day: 14 },
            { name: "Gaurav", month: "May", day: 11 },
            { name: "Ghaniba", month: "September", day: 21 },
            { name: "Rida", month: "August", day: 3 },
            { name: "Mubasher", month: "July", day: 18 },
            { name: "Akash", month: "August", day: 23 },
            { name: "Pavan", month: "August", day: 15 },
            { name: "Shanzey", month: "February", day: 29 },
            { name: "Bence", month: "September", day: 10 },
            { name: "Manas", month: "June", day: 12 },
            { name: "Jheel", month: "August", day: 15 },
            { name: "Manan", month: "September", day: 30 },
            { name: "Shashank", month: "October", day: 19 },
            { name: "John", month: "September", day: 10 },
            { name: "Michael", month: "August", day: 30 },
            { name: "Sabnis", month: "December", day: 20 },
            { name: "Kamat", month: "July", day: 10 },
            { name: "Ishani", month: "October", day: 8 },
            { name: "Mitali", month: "January", day: 24 },
            { name: "Ritu", month: "February", day: 11 },
            { name: "Raghav", month: "April", day: 12 },
            { name: "Poorvi", month: "January", day: 28 },
            { name: "Pranati", month: "October", day: 21 },
            { name: "Varun", month: "March", day: 5 },
            { name: "Misbah", month: "August", day: 26 },
            { name: "Zoe", month: "October", day: 24 },
            { name: "Arshiya", month: "July", day: 14 },
            { name: "Shazia", month: "March", day: 4 },
            { name: "Kankon", month: "September", day: 26 },
            { name: "Chanakya", month: "March", day: 7 }
        ];

        // Semester start date (Week 1 begins)
        const SEMESTER_START = new Date('2026-01-19');

        // State
        let tasks = [];
        let birthdays = [];
        let currentWeek = 1;
        let currentView = 'week';
        let showBirthdays = false;

        // Initialize
        function init() {
            loadTasks();
            loadBirthdays();
            updateGreeting();
            updateSummary();
            renderTasks();
            renderBirthdays();
            setupEventListeners();
        }

        // Load tasks from localStorage or seed data
        function loadTasks() {
            const saved = localStorage.getItem('pranav_tasks');
            if (saved) {
                tasks = JSON.parse(saved);
            } else {
                // Initialize from seed data
                tasks = seedData.map((item, index) => ({
                    id: index + 1,
                    ...item,
                    completed: false
                }));
                saveTasks();
            }
        }

        // Save tasks to localStorage
        function saveTasks() {
            localStorage.setItem('pranav_tasks', JSON.stringify(tasks));
        }

        // Load birthdays from localStorage or seed data
        function loadBirthdays() {
            const saved = localStorage.getItem('pranav_birthdays');
            if (saved) {
                birthdays = JSON.parse(saved);
            } else {
                // Initialize from seed data
                birthdays = birthdaySeedData.map((item, index) => ({
                    id: index + 1,
                    ...item
                }));
                saveBirthdays();
            }
        }

        // Save birthdays to localStorage
        function saveBirthdays() {
            localStorage.setItem('pranav_birthdays', JSON.stringify(birthdays));
        }

        // Get days until birthday (this year or next year)
        function getDaysUntilBirthday(birthday) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const monthIndex = monthNames.indexOf(birthday.month);

            if (monthIndex === -1) return 999; // Invalid month

            let birthdayThisYear = new Date(today.getFullYear(), monthIndex, birthday.day);
            birthdayThisYear.setHours(0, 0, 0, 0);

            // Handle Feb 29 for non-leap years
            if (birthday.month === 'February' && birthday.day === 29) {
                const year = today.getFullYear();
                const isLeapYear = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
                if (!isLeapYear) {
                    birthdayThisYear = new Date(year, 1, 28); // Use Feb 28
                }
            }

            let daysUntil = Math.ceil((birthdayThisYear - today) / (1000 * 60 * 60 * 24));

            if (daysUntil < 0) {
                // Birthday has passed this year, calculate for next year
                let birthdayNextYear = new Date(today.getFullYear() + 1, monthIndex, birthday.day);
                birthdayNextYear.setHours(0, 0, 0, 0);

                // Handle Feb 29 for non-leap years
                if (birthday.month === 'February' && birthday.day === 29) {
                    const nextYear = today.getFullYear() + 1;
                    const isLeapYear = (nextYear % 4 === 0 && nextYear % 100 !== 0) || (nextYear % 400 === 0);
                    if (!isLeapYear) {
                        birthdayNextYear = new Date(nextYear, 1, 28);
                    }
                }

                daysUntil = Math.ceil((birthdayNextYear - today) / (1000 * 60 * 60 * 24));
            }

            return daysUntil;
        }

        // Get upcoming birthdays within specified days
        function getUpcomingBirthdays(withinDays = 7) {
            return birthdays
                .filter(b => b.month && b.day) // Only valid entries
                .map(b => ({ ...b, daysUntil: getDaysUntilBirthday(b) }))
                .filter(b => b.daysUntil <= withinDays)
                .sort((a, b) => a.daysUntil - b.daysUntil);
        }

        // Get current week number (1-indexed)
        function getWeekNumber(date) {
            const d = new Date(date);
            const diffTime = d - SEMESTER_START;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return Math.floor(diffDays / 7) + 1;
        }

        // Get week date range
        function getWeekRange(weekNum) {
            const startDate = new Date(SEMESTER_START);
            startDate.setDate(startDate.getDate() + (weekNum - 1) * 7);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);
            return { start: startDate, end: endDate };
        }

        // Format date
        function formatDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        // Update greeting based on time
        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting;
            if (hour < 12) greeting = 'Good Morning';
            else if (hour < 17) greeting = 'Good Afternoon';
            else greeting = 'Good Evening';
            document.getElementById('greeting').textContent = `${greeting}, Pranav!`;
        }

        // Update summary
        function updateSummary() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            const twoDaysFromNow = new Date(today);
            twoDaysFromNow.setDate(twoDaysFromNow.getDate() + 2);

            const endOfWeek = new Date(today);
            endOfWeek.setDate(endOfWeek.getDate() + (7 - today.getDay()));

            const incompleteTasks = tasks.filter(t => !t.completed);

            const dueToday = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d.getTime() === today.getTime();
            });

            const dueTomorrow = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d.getTime() === tomorrow.getTime();
            });

            const dueThisWeek = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d > tomorrow && d <= endOfWeek;
            });

            // Head start suggestions (due in next 2 days, not completed)
            const headStartTasks = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d > today && d <= twoDaysFromNow;
            });

            let summaryParts = [];

            if (dueToday.length > 0) {
                const todayNames = dueToday.map(t => t.task).join(', ');
                summaryParts.push(`<strong>Due today:</strong> ${todayNames}`);
            }

            if (dueTomorrow.length > 0) {
                const tomorrowNames = dueTomorrow.map(t => t.task).join(', ');
                summaryParts.push(`<strong>Due tomorrow:</strong> ${tomorrowNames}`);
            }

            if (dueThisWeek.length > 0) {
                summaryParts.push(`<strong>${dueThisWeek.length}</strong> more task${dueThisWeek.length > 1 ? 's' : ''} due this week`);
            }

            if (headStartTasks.length > 0 && dueToday.length === 0) {
                const headStartName = headStartTasks[0].task;
                summaryParts.push(`<em>You should get a head start on ${headStartName}!</em>`);
            }

            if (summaryParts.length === 0) {
                summaryParts.push("You're all caught up! No pressing deadlines.");
            }

            document.getElementById('summary').innerHTML = summaryParts.join(' ');

            // Birthday reminders (7 days ahead)
            const upcomingBirthdays = getUpcomingBirthdays(7);
            const birthdayReminderEl = document.getElementById('birthdayReminder');

            if (upcomingBirthdays.length > 0) {
                let birthdayParts = [];
                upcomingBirthdays.forEach(b => {
                    if (b.daysUntil === 0) {
                        birthdayParts.push(`<strong>${b.name}'s birthday is TODAY!</strong>`);
                    } else if (b.daysUntil === 1) {
                        birthdayParts.push(`<strong>${b.name}'s birthday is tomorrow!</strong> Time to wish/get a gift.`);
                    } else {
                        birthdayParts.push(`<strong>${b.name}'s birthday</strong> is in ${b.daysUntil} days (${b.month} ${b.day}). Consider getting a gift!`);
                    }
                });

                if (birthdayReminderEl) {
                    birthdayReminderEl.innerHTML = birthdayParts.join('<br>');
                    birthdayReminderEl.style.display = 'block';
                }
            } else {
                if (birthdayReminderEl) {
                    birthdayReminderEl.style.display = 'none';
                }
            }
        }

        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksContainer');

            if (currentView === 'week') {
                renderWeekView(container);
            } else {
                renderAllView(container);
            }
        }

        // Render week view
        function renderWeekView(container) {
            const { start, end } = getWeekRange(currentWeek);
            document.getElementById('weekLabel').textContent = `Week ${currentWeek}`;
            document.getElementById('weekNav').style.display = 'flex';

            const weekTasks = tasks.filter(t => {
                const d = new Date(t.date);
                return d >= start && d <= end;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));

            if (weekTasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">No tasks this week</div>';
                return;
            }

            // Group by date
            const grouped = {};
            for (let i = 0; i < 7; i++) {
                const d = new Date(start);
                d.setDate(d.getDate() + i);
                const key = d.toISOString().split('T')[0];
                grouped[key] = [];
            }

            weekTasks.forEach(t => {
                if (grouped[t.date]) {
                    grouped[t.date].push(t);
                }
            });

            const today = new Date().toISOString().split('T')[0];

            let html = '';
            Object.entries(grouped).forEach(([date, dayTasks]) => {
                const isToday = date === today;
                const dateObj = new Date(date + 'T12:00:00');

                html += `
                    <div class="day-section">
                        <div class="day-header ${isToday ? 'today' : ''}">
                            <span>${formatDate(dateObj)}${isToday ? ' (Today)' : ''}</span>
                            <span>${dayTasks.length} task${dayTasks.length !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="task-list">
                            ${dayTasks.length === 0 ? '' : dayTasks.map(t => renderTaskItem(t)).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Render all tasks view
        function renderAllView(container) {
            document.getElementById('weekNav').style.display = 'none';

            const sortedTasks = [...tasks].sort((a, b) => new Date(a.date) - new Date(b.date));

            if (sortedTasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">No tasks yet</div>';
                return;
            }

            const html = `
                <div class="task-list all-tasks">
                    ${sortedTasks.map(t => renderTaskItem(t, true)).join('')}
                </div>
            `;
            container.innerHTML = html;
        }

        // Render single task item
        function renderTaskItem(task, showDate = false) {
            return `
                <div class="task-item ${task.completed ? 'completed' : ''}" data-id="${task.id}">
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                    <div class="task-info">
                        <div class="task-name">${task.task}</div>
                        <div class="task-subject">${task.subject}</div>
                        ${showDate ? `<div class="task-date">${formatDate(task.date)}</div>` : ''}
                    </div>
                    <span class="task-type ${task.type.toLowerCase()}">${task.type}</span>
                    <span class="task-time">${task.time}</span>
                    <div class="task-actions">
                        <button class="edit-btn">Edit</button>
                        <button class="delete-btn">Delete</button>
                    </div>
                </div>
            `;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Week navigation
            document.getElementById('prevWeek').addEventListener('click', () => {
                if (currentWeek > 1) {
                    currentWeek--;
                    renderTasks();
                }
            });

            document.getElementById('nextWeek').addEventListener('click', () => {
                currentWeek++;
                renderTasks();
            });

            // View toggle
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-toggle button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentView = btn.dataset.view;
                    renderTasks();
                });
            });

            // Add task button
            document.getElementById('addTaskBtn').addEventListener('click', openAddModal);

            // Modal close
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('modalOverlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeModal();
            });

            // Form submit
            document.getElementById('taskForm').addEventListener('submit', handleFormSubmit);

            // Task actions (delegated)
            document.getElementById('tasksContainer').addEventListener('click', handleTaskAction);
            document.getElementById('tasksContainer').addEventListener('change', handleTaskToggle);

            // Birthday toggle button
            document.getElementById('toggleBirthdaysBtn').addEventListener('click', () => {
                showBirthdays = !showBirthdays;
                const birthdaysSection = document.getElementById('birthdaysSection');
                birthdaysSection.style.display = showBirthdays ? 'block' : 'none';
                document.getElementById('toggleBirthdaysBtn').textContent = showBirthdays ? 'Hide Birthdays' : 'Birthdays';
            });

            // Birthday modal
            document.getElementById('addBirthdayBtn').addEventListener('click', openAddBirthdayModal);
            document.getElementById('cancelBirthdayBtn').addEventListener('click', closeBirthdayModal);
            document.getElementById('birthdayModalOverlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeBirthdayModal();
            });
            document.getElementById('birthdayForm').addEventListener('submit', handleBirthdayFormSubmit);

            // Birthday actions (delegated)
            document.getElementById('birthdayList').addEventListener('click', handleBirthdayAction);

            // Export birthdays
            document.getElementById('exportBirthdaysBtn').addEventListener('click', exportBirthdaysCSV);
        }

        // Open add modal
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add Task';
            document.getElementById('taskForm').reset();
            document.getElementById('taskId').value = '';
            document.getElementById('modalOverlay').classList.add('active');
        }

        // Open edit modal
        function openEditModal(task) {
            document.getElementById('modalTitle').textContent = 'Edit Task';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskName').value = task.task;
            document.getElementById('taskSubject').value = task.subject;
            document.getElementById('taskType').value = task.type;
            document.getElementById('taskDate').value = task.date;
            document.getElementById('taskTime').value = task.time;
            document.getElementById('modalOverlay').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // Handle form submit
        function handleFormSubmit(e) {
            e.preventDefault();

            const id = document.getElementById('taskId').value;
            const taskData = {
                task: document.getElementById('taskName').value,
                subject: document.getElementById('taskSubject').value,
                type: document.getElementById('taskType').value,
                date: document.getElementById('taskDate').value,
                time: document.getElementById('taskTime').value || 'TBD'
            };

            if (id) {
                // Edit existing
                const index = tasks.findIndex(t => t.id === parseInt(id));
                if (index !== -1) {
                    tasks[index] = { ...tasks[index], ...taskData };
                }
            } else {
                // Add new
                const newId = Math.max(0, ...tasks.map(t => t.id)) + 1;
                tasks.push({ id: newId, ...taskData, completed: false });
            }

            saveTasks();
            updateSummary();
            renderTasks();
            closeModal();
        }

        // Handle task actions (edit/delete)
        function handleTaskAction(e) {
            const taskItem = e.target.closest('.task-item');
            if (!taskItem) return;

            const id = parseInt(taskItem.dataset.id);
            const task = tasks.find(t => t.id === id);

            if (e.target.classList.contains('edit-btn')) {
                openEditModal(task);
            } else if (e.target.classList.contains('delete-btn')) {
                if (confirm('Delete this task?')) {
                    tasks = tasks.filter(t => t.id !== id);
                    saveTasks();
                    updateSummary();
                    renderTasks();
                }
            }
        }

        // Handle task toggle
        function handleTaskToggle(e) {
            if (!e.target.classList.contains('task-checkbox')) return;

            const taskItem = e.target.closest('.task-item');
            const id = parseInt(taskItem.dataset.id);
            const task = tasks.find(t => t.id === id);

            if (task) {
                task.completed = e.target.checked;
                saveTasks();
                updateSummary();
                renderTasks();
            }
        }

        // Render birthdays list
        function renderBirthdays() {
            const container = document.getElementById('birthdayList');

            if (birthdays.length === 0) {
                container.innerHTML = '<div class="no-birthdays">No birthdays saved yet</div>';
                return;
            }

            // Sort by days until birthday
            const sortedBirthdays = birthdays
                .filter(b => b.month && b.day)
                .map(b => ({ ...b, daysUntil: getDaysUntilBirthday(b) }))
                .sort((a, b) => a.daysUntil - b.daysUntil);

            const html = sortedBirthdays.map(b => {
                let countdownClass = '';
                let countdownText = '';

                if (b.daysUntil === 0) {
                    countdownClass = 'today';
                    countdownText = 'Today!';
                } else if (b.daysUntil <= 7) {
                    countdownClass = 'soon';
                    countdownText = `In ${b.daysUntil} day${b.daysUntil > 1 ? 's' : ''}`;
                } else {
                    countdownText = `In ${b.daysUntil} days`;
                }

                return `
                    <div class="birthday-item ${b.daysUntil <= 7 ? 'upcoming' : ''}" data-id="${b.id}">
                        <div class="birthday-icon">ðŸŽ‚</div>
                        <div class="birthday-info">
                            <div class="birthday-name">${b.name}</div>
                            <div class="birthday-date">${b.month} ${b.day}</div>
                        </div>
                        <span class="birthday-countdown ${countdownClass}">${countdownText}</span>
                        <div class="birthday-actions">
                            <button class="edit-btn">Edit</button>
                            <button class="delete-btn">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Open add birthday modal
        function openAddBirthdayModal() {
            document.getElementById('birthdayModalTitle').textContent = 'Add Birthday';
            document.getElementById('birthdayForm').reset();
            document.getElementById('birthdayId').value = '';
            document.getElementById('birthdayModalOverlay').classList.add('active');
        }

        // Open edit birthday modal
        function openEditBirthdayModal(birthday) {
            document.getElementById('birthdayModalTitle').textContent = 'Edit Birthday';
            document.getElementById('birthdayId').value = birthday.id;
            document.getElementById('birthdayName').value = birthday.name;
            document.getElementById('birthdayMonth').value = birthday.month;
            document.getElementById('birthdayDay').value = birthday.day;
            document.getElementById('birthdayModalOverlay').classList.add('active');
        }

        // Close birthday modal
        function closeBirthdayModal() {
            document.getElementById('birthdayModalOverlay').classList.remove('active');
        }

        // Handle birthday form submit
        function handleBirthdayFormSubmit(e) {
            e.preventDefault();

            const id = document.getElementById('birthdayId').value;
            const birthdayData = {
                name: document.getElementById('birthdayName').value,
                month: document.getElementById('birthdayMonth').value,
                day: parseInt(document.getElementById('birthdayDay').value)
            };

            if (id) {
                // Edit existing
                const index = birthdays.findIndex(b => b.id === parseInt(id));
                if (index !== -1) {
                    birthdays[index] = { ...birthdays[index], ...birthdayData };
                }
            } else {
                // Add new
                const newId = Math.max(0, ...birthdays.map(b => b.id)) + 1;
                birthdays.push({ id: newId, ...birthdayData });
            }

            saveBirthdays();
            updateSummary();
            renderBirthdays();
            closeBirthdayModal();
        }

        // Handle birthday actions (edit/delete)
        function handleBirthdayAction(e) {
            const birthdayItem = e.target.closest('.birthday-item');
            if (!birthdayItem) return;

            const id = parseInt(birthdayItem.dataset.id);
            const birthday = birthdays.find(b => b.id === id);

            if (e.target.classList.contains('edit-btn')) {
                openEditBirthdayModal(birthday);
            } else if (e.target.classList.contains('delete-btn')) {
                if (confirm(`Delete ${birthday.name}'s birthday?`)) {
                    birthdays = birthdays.filter(b => b.id !== id);
                    saveBirthdays();
                    updateSummary();
                    renderBirthdays();
                }
            }
        }

        // Export birthdays to CSV
        function exportBirthdaysCSV() {
            const csvContent = 'Name,Birthday\n' +
                birthdays
                    .filter(b => b.name)
                    .map(b => `${b.name},${b.month || ''} ${b.day || ''}`.trim())
                    .join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'birthdays.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Start the app
        init();
    </script>
</body>
</html>
