<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .greeting {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .summary {
            background: #f0f7ff;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            font-size: 15px;
            color: #1e40af;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .week-nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .week-nav button {
            padding: 8px 16px;
            border: none;
            background: #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .week-nav button:hover {
            background: #d1d5db;
        }

        .week-label {
            font-weight: 600;
            min-width: 120px;
            text-align: center;
        }

        .add-btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-left: auto;
        }

        .add-btn:hover {
            background: #2563eb;
        }

        .tasks-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .day-section {
            border-bottom: 1px solid #e5e7eb;
        }

        .day-section:last-child {
            border-bottom: none;
        }

        .day-header {
            background: #f9fafb;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 14px;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
        }

        .day-header.today {
            background: #dbeafe;
            color: #1e40af;
        }

        .task-list {
            padding: 0;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            border-bottom: 1px solid #f3f4f6;
            gap: 12px;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item.completed {
            background: #f9fafb;
        }

        .task-item.completed .task-name,
        .task-item.completed .task-subject {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .task-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #3b82f6;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            font-size: 15px;
        }

        .task-subject {
            font-size: 13px;
            color: #6b7280;
            margin-top: 2px;
        }

        .task-type {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .task-type.assignment { background: #dbeafe; color: #1e40af; }
        .task-type.exam { background: #fee2e2; color: #991b1b; }
        .task-type.project { background: #d1fae5; color: #065f46; }
        .task-type.presentation { background: #fef3c7; color: #92400e; }
        .task-type.deliverable { background: #e9d5ff; color: #6b21a8; }

        .task-time {
            font-size: 13px;
            color: #6b7280;
            min-width: 80px;
            text-align: right;
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-actions button {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .edit-btn:hover {
            background: #e5e7eb;
        }

        .delete-btn {
            background: #fee2e2;
            color: #991b1b;
        }

        .delete-btn:hover {
            background: #fecaca;
        }

        .no-tasks {
            padding: 40px;
            text-align: center;
            color: #9ca3af;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
        }

        .modal h2 {
            margin-bottom: 20px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .modal-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .cancel-btn {
            background: #f3f4f6;
            color: #374151;
        }

        .save-btn {
            background: #3b82f6;
            color: white;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            background: #e5e7eb;
            padding: 4px;
            border-radius: 8px;
        }

        .view-toggle button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .view-toggle button.active {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .all-tasks .task-date {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="greeting" id="greeting"></div>
        <div class="summary" id="summary"></div>
    </div>

    <div class="controls">
        <div class="view-toggle">
            <button class="active" data-view="week">Week View</button>
            <button data-view="all">All Tasks</button>
        </div>
        <div class="week-nav" id="weekNav">
            <button id="prevWeek">&larr; Prev</button>
            <span class="week-label" id="weekLabel">Week 1</span>
            <button id="nextWeek">Next &rarr;</button>
        </div>
        <button class="add-btn" id="addTaskBtn">+ Add Task</button>
    </div>

    <div class="tasks-container" id="tasksContainer"></div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2 id="modalTitle">Add Task</h2>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label for="taskName">Task Name</label>
                    <input type="text" id="taskName" required>
                </div>
                <div class="form-group">
                    <label for="taskSubject">Subject/Course</label>
                    <input type="text" id="taskSubject" required>
                </div>
                <div class="form-group">
                    <label for="taskType">Type</label>
                    <select id="taskType">
                        <option value="Assignment">Assignment</option>
                        <option value="Exam">Exam</option>
                        <option value="Project">Project</option>
                        <option value="Presentation">Presentation</option>
                        <option value="Deliverable">Deliverable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskDate">Due Date</label>
                    <input type="date" id="taskDate" required>
                </div>
                <div class="form-group">
                    <label for="taskTime">Due Time</label>
                    <input type="text" id="taskTime" placeholder="e.g., 11:59 PM or TBD">
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" id="cancelBtn">Cancel</button>
                    <button type="submit" class="save-btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initial seed data from assignments.csv
        const seedData = [
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 1", type: "Assignment", date: "2026-01-26", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 2", type: "Assignment", date: "2026-02-02", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Problem Set 1", type: "Assignment", date: "2026-02-04", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 3", type: "Assignment", date: "2026-02-09", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 4", type: "Assignment", date: "2026-02-16", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 5", type: "Assignment", date: "2026-02-22", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 6", type: "Assignment", date: "2026-03-02", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Problem Set 2", type: "Assignment", date: "2026-03-04", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 7", type: "Assignment", date: "2026-03-09", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 8", type: "Assignment", date: "2026-03-23", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Paper Topics", type: "Deliverable", date: "2026-04-01", time: "TBD" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 9", type: "Assignment", date: "2026-04-06", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 10", type: "Assignment", date: "2026-04-13", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Reader Response 11", type: "Assignment", date: "2026-04-20", time: "11:59 PM" },
            { subject: "Economic Measurement of Discrimination", task: "Problem Set 3", type: "Assignment", date: "2026-04-22", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Final Presentation", type: "Presentation", date: "2026-04-29", time: "10:00 AM" },
            { subject: "Economic Measurement of Discrimination", task: "Final Paper", type: "Project", date: "2026-05-08", time: "TBD" },
            { subject: "International Trade", task: "Problem Set 1 (Chapter 3)", type: "Assignment", date: "2026-02-05", time: "TBD" },
            { subject: "International Trade", task: "Problem Set 2 (Chapter 5)", type: "Assignment", date: "2026-02-19", time: "TBD" },
            { subject: "International Trade", task: "Midterm Exam", type: "Exam", date: "2026-03-05", time: "TBD" },
            { subject: "International Trade", task: "Problem Set 3 (Chapter 9)", type: "Assignment", date: "2026-04-02", time: "TBD" },
            { subject: "International Trade", task: "Short Paper", type: "Assignment", date: "2026-04-16", time: "TBD" },
            { subject: "International Trade", task: "Final Exam", type: "Exam", date: "2026-05-08", time: "TBD" },
            { subject: "Applying Machine Learning", task: "PS 1 - Clustering", type: "Assignment", date: "2026-01-27", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 0 - Programming", type: "Assignment", date: "2026-02-03", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 2 - Visualization", type: "Assignment", date: "2026-02-03", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 3 - Trees", type: "Assignment", date: "2026-02-10", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 4 - Measurement and Fit", type: "Assignment", date: "2026-02-17", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 5 - Generalizing Fit", type: "Assignment", date: "2026-02-24", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 6 - Regularization and Loss", type: "Assignment", date: "2026-03-03", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 7 - Causality and Optimal Pricing", type: "Assignment", date: "2026-03-10", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 8 - Synthetic Data", type: "Assignment", date: "2026-03-24", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 9 - Optimal Pricing Competition", type: "Assignment", date: "2026-03-31", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 10 - Fairness", type: "Assignment", date: "2026-04-14", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "PS 11 - AI", type: "Assignment", date: "2026-04-21", time: "11:00 AM" },
            { subject: "Applying Machine Learning", task: "Project Presentation", type: "Presentation", date: "2026-04-29", time: "3:10 PM" },
            { subject: "Applying Machine Learning", task: "Final Project", type: "Project", date: "2026-05-09", time: "TBD" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 1 - Glo-Stick I", type: "Assignment", date: "2026-02-04", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 2 - Glo-Stick II", type: "Assignment", date: "2026-02-11", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 3 - Revenue Recognition", type: "Assignment", date: "2026-02-18", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Written Assignment 4 - Doubtful Accounts & Deferred Taxes", type: "Assignment", date: "2026-02-25", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Mid-Term Exam", type: "Exam", date: "2026-03-04", time: "5:10 PM" },
            { subject: "Financial Accounting & Analysis", task: "Final Exam", type: "Exam", date: "2026-05-15", time: "TBD" },
            { subject: "Using Big Data to Develop Public Policy", task: "Final Paper Proposal Outline", type: "Deliverable", date: "2026-03-11", time: "TBD" },
            { subject: "Using Big Data to Develop Public Policy", task: "Midterm (take-home)", type: "Exam", date: "2026-03-10", time: "TBD" },
            { subject: "Using Big Data to Develop Public Policy", task: "Final Paper Presentation", type: "Presentation", date: "2026-04-28", time: "7:10 PM" },
            { subject: "Using Big Data to Develop Public Policy", task: "Final Paper", type: "Project", date: "2026-05-13", time: "TBD" }
        ];

        // Semester start date (Week 1 begins)
        const SEMESTER_START = new Date('2026-01-20');

        // State
        let tasks = [];
        let currentWeek = 1;
        let currentView = 'week';

        // Initialize
        function init() {
            loadTasks();
            updateGreeting();
            updateSummary();
            renderTasks();
            setupEventListeners();
        }

        // Load tasks from localStorage or seed data
        function loadTasks() {
            const saved = localStorage.getItem('pranav_tasks');
            if (saved) {
                tasks = JSON.parse(saved);
            } else {
                // Initialize from seed data
                tasks = seedData.map((item, index) => ({
                    id: index + 1,
                    ...item,
                    completed: false
                }));
                saveTasks();
            }
        }

        // Save tasks to localStorage
        function saveTasks() {
            localStorage.setItem('pranav_tasks', JSON.stringify(tasks));
        }

        // Get current week number (1-indexed)
        function getWeekNumber(date) {
            const d = new Date(date);
            const diffTime = d - SEMESTER_START;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return Math.floor(diffDays / 7) + 1;
        }

        // Get week date range
        function getWeekRange(weekNum) {
            const startDate = new Date(SEMESTER_START);
            startDate.setDate(startDate.getDate() + (weekNum - 1) * 7);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);
            return { start: startDate, end: endDate };
        }

        // Format date
        function formatDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        // Update greeting based on time
        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting;
            if (hour < 12) greeting = 'Good Morning';
            else if (hour < 17) greeting = 'Good Afternoon';
            else greeting = 'Good Evening';
            document.getElementById('greeting').textContent = `${greeting}, Pranav!`;
        }

        // Update summary
        function updateSummary() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            const twoDaysFromNow = new Date(today);
            twoDaysFromNow.setDate(twoDaysFromNow.getDate() + 2);

            const endOfWeek = new Date(today);
            endOfWeek.setDate(endOfWeek.getDate() + (7 - today.getDay()));

            const incompleteTasks = tasks.filter(t => !t.completed);

            const dueToday = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d.getTime() === today.getTime();
            });

            const dueTomorrow = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d.getTime() === tomorrow.getTime();
            });

            const dueThisWeek = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d > tomorrow && d <= endOfWeek;
            });

            // Head start suggestions (due in next 2 days, not completed)
            const headStartTasks = incompleteTasks.filter(t => {
                const d = new Date(t.date);
                d.setHours(0, 0, 0, 0);
                return d > today && d <= twoDaysFromNow;
            });

            let summaryParts = [];

            if (dueToday.length > 0) {
                const todayNames = dueToday.map(t => t.task).join(', ');
                summaryParts.push(`<strong>Due today:</strong> ${todayNames}`);
            }

            if (dueTomorrow.length > 0) {
                const tomorrowNames = dueTomorrow.map(t => t.task).join(', ');
                summaryParts.push(`<strong>Due tomorrow:</strong> ${tomorrowNames}`);
            }

            if (dueThisWeek.length > 0) {
                summaryParts.push(`<strong>${dueThisWeek.length}</strong> more task${dueThisWeek.length > 1 ? 's' : ''} due this week`);
            }

            if (headStartTasks.length > 0 && dueToday.length === 0) {
                const headStartName = headStartTasks[0].task;
                summaryParts.push(`<em>You should get a head start on ${headStartName}!</em>`);
            }

            if (summaryParts.length === 0) {
                summaryParts.push("You're all caught up! No pressing deadlines.");
            }

            document.getElementById('summary').innerHTML = summaryParts.join(' ');
        }

        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksContainer');

            if (currentView === 'week') {
                renderWeekView(container);
            } else {
                renderAllView(container);
            }
        }

        // Render week view
        function renderWeekView(container) {
            const { start, end } = getWeekRange(currentWeek);
            document.getElementById('weekLabel').textContent = `Week ${currentWeek}`;
            document.getElementById('weekNav').style.display = 'flex';

            const weekTasks = tasks.filter(t => {
                const d = new Date(t.date);
                return d >= start && d <= end;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));

            if (weekTasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">No tasks this week</div>';
                return;
            }

            // Group by date
            const grouped = {};
            for (let i = 0; i < 7; i++) {
                const d = new Date(start);
                d.setDate(d.getDate() + i);
                const key = d.toISOString().split('T')[0];
                grouped[key] = [];
            }

            weekTasks.forEach(t => {
                if (grouped[t.date]) {
                    grouped[t.date].push(t);
                }
            });

            const today = new Date().toISOString().split('T')[0];

            let html = '';
            Object.entries(grouped).forEach(([date, dayTasks]) => {
                const isToday = date === today;
                const dateObj = new Date(date + 'T12:00:00');

                html += `
                    <div class="day-section">
                        <div class="day-header ${isToday ? 'today' : ''}">
                            <span>${formatDate(dateObj)}${isToday ? ' (Today)' : ''}</span>
                            <span>${dayTasks.length} task${dayTasks.length !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="task-list">
                            ${dayTasks.length === 0 ? '' : dayTasks.map(t => renderTaskItem(t)).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Render all tasks view
        function renderAllView(container) {
            document.getElementById('weekNav').style.display = 'none';

            const sortedTasks = [...tasks].sort((a, b) => new Date(a.date) - new Date(b.date));

            if (sortedTasks.length === 0) {
                container.innerHTML = '<div class="no-tasks">No tasks yet</div>';
                return;
            }

            const html = `
                <div class="task-list all-tasks">
                    ${sortedTasks.map(t => renderTaskItem(t, true)).join('')}
                </div>
            `;
            container.innerHTML = html;
        }

        // Render single task item
        function renderTaskItem(task, showDate = false) {
            return `
                <div class="task-item ${task.completed ? 'completed' : ''}" data-id="${task.id}">
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                    <div class="task-info">
                        <div class="task-name">${task.task}</div>
                        <div class="task-subject">${task.subject}</div>
                        ${showDate ? `<div class="task-date">${formatDate(task.date)}</div>` : ''}
                    </div>
                    <span class="task-type ${task.type.toLowerCase()}">${task.type}</span>
                    <span class="task-time">${task.time}</span>
                    <div class="task-actions">
                        <button class="edit-btn">Edit</button>
                        <button class="delete-btn">Delete</button>
                    </div>
                </div>
            `;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Week navigation
            document.getElementById('prevWeek').addEventListener('click', () => {
                if (currentWeek > 1) {
                    currentWeek--;
                    renderTasks();
                }
            });

            document.getElementById('nextWeek').addEventListener('click', () => {
                currentWeek++;
                renderTasks();
            });

            // View toggle
            document.querySelectorAll('.view-toggle button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.view-toggle button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentView = btn.dataset.view;
                    renderTasks();
                });
            });

            // Add task button
            document.getElementById('addTaskBtn').addEventListener('click', openAddModal);

            // Modal close
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('modalOverlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeModal();
            });

            // Form submit
            document.getElementById('taskForm').addEventListener('submit', handleFormSubmit);

            // Task actions (delegated)
            document.getElementById('tasksContainer').addEventListener('click', handleTaskAction);
            document.getElementById('tasksContainer').addEventListener('change', handleTaskToggle);
        }

        // Open add modal
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add Task';
            document.getElementById('taskForm').reset();
            document.getElementById('taskId').value = '';
            document.getElementById('modalOverlay').classList.add('active');
        }

        // Open edit modal
        function openEditModal(task) {
            document.getElementById('modalTitle').textContent = 'Edit Task';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskName').value = task.task;
            document.getElementById('taskSubject').value = task.subject;
            document.getElementById('taskType').value = task.type;
            document.getElementById('taskDate').value = task.date;
            document.getElementById('taskTime').value = task.time;
            document.getElementById('modalOverlay').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // Handle form submit
        function handleFormSubmit(e) {
            e.preventDefault();

            const id = document.getElementById('taskId').value;
            const taskData = {
                task: document.getElementById('taskName').value,
                subject: document.getElementById('taskSubject').value,
                type: document.getElementById('taskType').value,
                date: document.getElementById('taskDate').value,
                time: document.getElementById('taskTime').value || 'TBD'
            };

            if (id) {
                // Edit existing
                const index = tasks.findIndex(t => t.id === parseInt(id));
                if (index !== -1) {
                    tasks[index] = { ...tasks[index], ...taskData };
                }
            } else {
                // Add new
                const newId = Math.max(0, ...tasks.map(t => t.id)) + 1;
                tasks.push({ id: newId, ...taskData, completed: false });
            }

            saveTasks();
            updateSummary();
            renderTasks();
            closeModal();
        }

        // Handle task actions (edit/delete)
        function handleTaskAction(e) {
            const taskItem = e.target.closest('.task-item');
            if (!taskItem) return;

            const id = parseInt(taskItem.dataset.id);
            const task = tasks.find(t => t.id === id);

            if (e.target.classList.contains('edit-btn')) {
                openEditModal(task);
            } else if (e.target.classList.contains('delete-btn')) {
                if (confirm('Delete this task?')) {
                    tasks = tasks.filter(t => t.id !== id);
                    saveTasks();
                    updateSummary();
                    renderTasks();
                }
            }
        }

        // Handle task toggle
        function handleTaskToggle(e) {
            if (!e.target.classList.contains('task-checkbox')) return;

            const taskItem = e.target.closest('.task-item');
            const id = parseInt(taskItem.dataset.id);
            const task = tasks.find(t => t.id === id);

            if (task) {
                task.completed = e.target.checked;
                saveTasks();
                updateSummary();
                renderTasks();
            }
        }

        // Start the app
        init();
    </script>
</body>
</html>
